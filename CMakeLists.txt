CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

IF(DEFINED CMAKE_BUILD_TYPE)
  SET(CMAKE_BUILD_TYPE ${CMAKE_BUILD_TYPE} CACHE STRING "Choose the type of build, options are: None(CMAKE_CXX_FLAGS or CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel.")
ELSE()
  SET(CMAKE_BUILD_TYPE RelWithDebInfo CACHE STRING "Choose the type of build, options are: None(CMAKE_CXX_FLAGS or CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel.")
ENDIF()

PROJECT(Karazeh)

IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
  SET(CMAKE_INSTALL_PREFIX ${EXECUTABLE_OUTPUT_PATH} CACHE PATH "Karazeh install prefix" FORCE)
ENDIF()

SET( CMAKE_MODULE_PATH 
  ${CMAKE_SOURCE_DIR}/cmake 
  ${CMAKE_SOURCE_DIR}/cmake/scripts
  ${CMAKE_SOURCE_DIR}/cmake/modules
  ${CMAKE_MODULE_PATH})

INCLUDE(FindModule)
INCLUDE(CheckIncludeFileCXX)
INCLUDE(CMakeDependentOption)

SET(EXECUTABLE_OUTPUT_PATH "${CMAKE_SOURCE_DIR}/bin")
SET(LIBRARY_OUTPUT_PATH "${CMAKE_SOURCE_DIR}/lib")
SET(Boost_USE_MULTITHREAD ON)

IF(WIN32)
  ADD_DEFINITIONS("-D_CRT_SECURE_NO_WARNINGS")
  ADD_DEFINITIONS("-DCURL_STATICLIB")
ELSE()
  ADD_DEFINITIONS("-DENABLE_BINRELOC")
ENDIF()

# Options
OPTION(KARAZEH_BUILD_TESTS OFF "Build the tests")
OPTION(KARAZEH_BUILD_LUA_BINDINGS ON "Build Lua bindings using SWIG")

FIND_PACKAGE(Boost 1.46 COMPONENTS filesystem system REQUIRED)
FIND_PACKAGE(CURL REQUIRED)

INCLUDE_DIRECTORIES( ${CURL_INCLUDE_DIRS} ${Boost_INCLUDE_DIRS} )

LINK_DIRECTORIES(${BOOST_LIBRARY_DIRS} ${CURL_LIBRARY_DIRS})
LINK_LIBRARIES( ${Boost_LIBRARIES} ${CURL_LIBRARIES})

ADD_SUBDIRECTORY(src)
IF (KARAZEH_BUILD_TESTS)
  ADD_SUBDIRECTORY(test/unit)
ENDIF()